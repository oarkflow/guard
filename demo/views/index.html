<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Security Demo - Guard Protection System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .test-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .test-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .test-card p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn.danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .btn.danger:hover {
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .btn.warning:hover {
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            display: none;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .metrics {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .metrics h3 {
            margin-bottom: 15px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #34495e;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.active {
            background: #27ae60;
        }

        .status-indicator.blocked {
            background: #e74c3c;
        }

        .status-indicator.warning {
            background: #f39c12;
        }

        .demo-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .demo-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .demo-tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }

        .demo-tab:hover {
            color: #2980b9;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è Advanced Security Demo</h1>
            <p>Comprehensive Security Rule Testing Platform</p>
        </div>

        <div class="content">
            <!-- Navigation Tabs -->
            <div class="demo-tabs">
                <button class="demo-tab active" onclick="showTab('authentication')">Authentication Security</button>
                <button class="demo-tab" onclick="showTab('injection')">Injection Attacks</button>
                <button class="demo-tab" onclick="showTab('behavioral')">Behavioral Detection</button>
                <button class="demo-tab" onclick="showTab('metrics')">Security Metrics</button>
            </div>

            <!-- Authentication Security Tab -->
            <div id="authentication" class="tab-content active">
                <div class="section">
                    <h2>üîê Authentication Security Tests</h2>

                    <div class="test-grid">
                        <div class="test-card">
                            <h3>Bot Login Detection</h3>
                            <p>Tests detection of automated bot login attempts based on user agent patterns.</p>
                            <button class="btn danger" onclick="testBotLogin()">Test Bot Login</button>
                            <button class="btn" onclick="testNormalLogin()">Test Normal Login</button>
                            <div id="bot-login-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>Login Rate Limiting</h3>
                            <p>Tests protection against brute force login attempts.</p>
                            <button class="btn danger" onclick="testLoginRateLimit()">Test Rate Limit</button>
                            <div id="rate-limit-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>Multiple Account Detection</h3>
                            <p>Detects attempts to use multiple usernames from the same IP.</p>
                            <button class="btn warning" onclick="testMultipleLogins()">Test Multiple Logins</button>
                            <button class="btn warning" onclick="testMultipleSignups()">Test Multiple Signups</button>
                            <div id="multiple-accounts-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>Credential Stuffing</h3>
                            <p>Detects attempts using common/weak passwords.</p>
                            <button class="btn danger" onclick="testCredentialStuffing()">Test Credential
                                Stuffing</button>
                            <div id="credential-stuffing-result" class="result"></div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>üåç Geolocation & Time-based Security</h2>

                    <div class="test-grid">
                        <div class="test-card">
                            <h3>Business Hours Access</h3>
                            <p>Tests access control based on business hours (9 AM - 6 PM UTC).</p>
                            <button class="btn warning" onclick="testBusinessHours()">Test Business Hours</button>
                            <div id="business-hours-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>Geolocation Anomaly</h3>
                            <p>Tests detection of logins from unexpected regions.</p>
                            <button class="btn warning" onclick="testGeolocation()">Test Geolocation</button>
                            <div id="geolocation-result" class="result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Injection Attacks Tab -->
            <div id="injection" class="tab-content">
                <div class="section">
                    <h2>üíâ Injection Attack Detection</h2>

                    <div class="test-grid">
                        <div class="test-card">
                            <h3>SQL Injection</h3>
                            <p>Tests detection of SQL injection attempts in URLs and request bodies.</p>
                            <button class="btn danger" onclick="testSQLInjection()">Test SQL Injection</button>
                            <div id="sql-injection-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>XSS (Cross-Site Scripting)</h3>
                            <p>Tests detection of XSS attempts using various techniques.</p>
                            <button class="btn danger" onclick="testXSS()">Test XSS</button>
                            <div id="xss-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>Command Injection</h3>
                            <p>Tests detection of command injection attempts.</p>
                            <button class="btn danger" onclick="testCommandInjection()">Test Command Injection</button>
                            <div id="command-injection-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>Path Traversal</h3>
                            <p>Tests detection of directory traversal attacks.</p>
                            <button class="btn danger" onclick="testPathTraversal()">Test Path Traversal</button>
                            <div id="path-traversal-result" class="result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Behavioral Detection Tab -->
            <div id="behavioral" class="tab-content">
                <div class="section">
                    <h2>üïµÔ∏è Behavioral Security Detection</h2>

                    <div class="test-grid">
                        <div class="test-card">
                            <h3>DDoS Detection</h3>
                            <p>Tests detection of distributed denial of service attacks.</p>
                            <button class="btn danger" onclick="testDDoS()">Test DDoS</button>
                            <div id="ddos-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>API Abuse</h3>
                            <p>Tests detection of excessive API usage patterns.</p>
                            <button class="btn warning" onclick="testAPIAbuse()">Test API Abuse</button>
                            <div id="api-abuse-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>Data Exfiltration</h3>
                            <p>Tests detection of potential data exfiltration attempts.</p>
                            <button class="btn danger" onclick="testDataExfiltration()">Test Data Exfiltration</button>
                            <div id="data-exfiltration-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>Privilege Escalation</h3>
                            <p>Tests detection of attempts to gain elevated privileges.</p>
                            <button class="btn danger" onclick="testPrivilegeEscalation()">Test Privilege
                                Escalation</button>
                            <div id="privilege-escalation-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>Reconnaissance</h3>
                            <p>Tests detection of scanning and reconnaissance activities.</p>
                            <button class="btn warning" onclick="testReconnaissance()">Test Reconnaissance</button>
                            <div id="reconnaissance-result" class="result"></div>
                        </div>

                        <div class="test-card">
                            <h3>Session Hijacking</h3>
                            <p>Tests detection of potential session hijacking attempts.</p>
                            <button class="btn danger" onclick="testSessionHijacking()">Test Session Hijacking</button>
                            <div id="session-hijacking-result" class="result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Metrics Tab -->
            <div id="metrics" class="tab-content">
                <div class="section">
                    <h2>üìä Real-time Security Metrics</h2>

                    <div class="metrics" id="security-metrics">
                        <h3>Loading metrics...</h3>
                    </div>

                    <button class="btn" onclick="refreshMetrics()">Refresh Metrics</button>
                    <button class="btn" onclick="runAllTests()">Run All Security Tests</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.demo-tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Utility function to show results
        function showResult(elementId, message, type = 'success') {
            const resultElement = document.getElementById(elementId);
            resultElement.className = `result ${type}`;
            resultElement.innerHTML = message;
            resultElement.style.display = 'block';
        }

        // Authentication Security Tests
        async function testBotLogin() {
            try {
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'python-requests/2.28.1'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'password123'
                    })
                });

                const result = await response.json();
                const type = response.status === 403 ? 'success' : 'error';
                const message = response.status === 403
                    ? '‚úÖ Bot login detected and blocked!'
                    : `‚ùå Bot login not detected (Status: ${response.status})`;

                showResult('bot-login-result', message, type);
            } catch (error) {
                showResult('bot-login-result', `Error: ${error.message}`, 'error');
            }
        }

        async function testNormalLogin() {
            try {
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'password123'
                    })
                });

                const result = await response.json();
                const type = response.status === 200 ? 'success' : 'warning';
                const message = response.status === 200
                    ? '‚úÖ Normal login allowed'
                    : `‚ö†Ô∏è Normal login blocked (Status: ${response.status})`;

                showResult('bot-login-result', message, type);
            } catch (error) {
                showResult('bot-login-result', `Error: ${error.message}`, 'error');
            }
        }

        async function testLoginRateLimit() {
            showResult('rate-limit-result', 'üîÑ Testing rate limiting...', 'warning');

            let blockedCount = 0;
            for (let i = 0; i < 6; i++) {
                try {
                    const response = await fetch('/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            username: `testuser${i}`,
                            password: 'wrongpassword'
                        })
                    });

                    if (response.status === 429 || response.status === 403) {
                        blockedCount++;
                    }

                    await new Promise(resolve => setTimeout(resolve, 200));
                } catch (error) {
                    console.error('Rate limit test error:', error);
                }
            }

            const message = blockedCount > 0
                ? `‚úÖ Rate limiting active! ${blockedCount} requests blocked`
                : '‚ö†Ô∏è Rate limiting may not be active';
            const type = blockedCount > 0 ? 'success' : 'warning';

            showResult('rate-limit-result', message, type);
        }

        async function testMultipleLogins() {
            showResult('multiple-accounts-result', 'üîÑ Testing multiple login detection...', 'warning');

            const usernames = ['testuser1', 'testuser2', 'testuser3', 'testuser4'];
            let responses = [];

            for (const username of usernames) {
                try {
                    const response = await fetch('/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            username: username,
                            password: 'password'
                        })
                    });
                    responses.push(response.status);
                    await new Promise(resolve => setTimeout(resolve, 100));
                } catch (error) {
                    console.error('Multiple login test error:', error);
                }
            }

            const blockedCount = responses.filter(status => status === 403 || status === 429).length;
            const message = blockedCount > 0
                ? `‚úÖ Multiple login detection active! ${blockedCount} attempts flagged`
                : '‚ö†Ô∏è Multiple login detection may need tuning';
            const type = blockedCount > 0 ? 'success' : 'warning';

            showResult('multiple-accounts-result', message, type);
        }

        async function testMultipleSignups() {
            showResult('multiple-accounts-result', 'üîÑ Testing multiple signup detection...', 'warning');

            const signups = [
                { username: 'newuser1', email: 'newuser1@test.com' },
                { username: 'newuser2', email: 'newuser2@test.com' },
                { username: 'newuser3', email: 'newuser3@test.com' }
            ];

            let responses = [];

            for (const signup of signups) {
                try {
                    const response = await fetch('/auth/signup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            ...signup,
                            password: 'password123',
                            country: 'US'
                        })
                    });
                    responses.push(response.status);
                    await new Promise(resolve => setTimeout(resolve, 100));
                } catch (error) {
                    console.error('Multiple signup test error:', error);
                }
            }

            const flaggedCount = responses.filter(status => status === 429 || status === 403).length;
            const message = flaggedCount > 0
                ? `‚úÖ Multiple signup detection active! ${flaggedCount} attempts flagged`
                : '‚ö†Ô∏è Multiple signup detection may need tuning';
            const type = flaggedCount > 0 ? 'success' : 'warning';

            showResult('multiple-accounts-result', message, type);
        }

        async function testCredentialStuffing() {
            try {
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: '123456'
                    })
                });

                const type = response.status === 403 ? 'success' : 'warning';
                const message = response.status === 403
                    ? '‚úÖ Credential stuffing detected and blocked!'
                    : `‚ö†Ô∏è Credential stuffing not detected (Status: ${response.status})`;

                showResult('credential-stuffing-result', message, type);
            } catch (error) {
                showResult('credential-stuffing-result', `Error: ${error.message}`, 'error');
            }
        }

        // Injection Attack Tests
        async function testSQLInjection() {
            try {
                const response = await fetch("/api/users?id=1' UNION SELECT * FROM users--");

                const type = response.status === 403 ? 'success' : 'warning';
                const message = response.status === 403
                    ? '‚úÖ SQL injection detected and blocked!'
                    : `‚ö†Ô∏è SQL injection not detected (Status: ${response.status})`;

                showResult('sql-injection-result', message, type);
            } catch (error) {
                showResult('sql-injection-result', `Error: ${error.message}`, 'error');
            }
        }

        async function testXSS() {
            try {
                const response = await fetch("/test/xss?comment=%3Cscript%3Ealert('xss')%3C/script%3E");

                const type = response.status === 403 ? 'success' : 'warning';
                const message = response.status === 403
                    ? '‚úÖ XSS attack detected and blocked!'
                    : `‚ö†Ô∏è XSS attack not detected (Status: ${response.status})`;

                showResult('xss-result', message, type);
            } catch (error) {
                showResult('xss-result', `Error: ${error.message}`, 'error');
            }
        }

        async function testCommandInjection() {
            try {
                const response = await fetch("/api/users?cmd=ls; rm -rf /");

                const type = response.status === 403 ? 'success' : 'warning';
                const message = response.status === 403
                    ? '‚úÖ Command injection detected and blocked!'
                    : `‚ö†Ô∏è Command injection not detected (Status: ${response.status})`;

                showResult('command-injection-result', message, type);
            } catch (error) {
                showResult('command-injection-result', `Error: ${error.message}`, 'error');
            }
        }

        async function testPathTraversal() {
            try {
                const response = await fetch("/api/../../../etc/passwd");

                const type = response.status === 403 ? 'success' : 'warning';
                const message = response.status === 403
                    ? '‚úÖ Path traversal detected and blocked!'
                    : `‚ö†Ô∏è Path traversal not detected (Status: ${response.status})`;

                showResult('path-traversal-result', message, type);
            } catch (error) {
                showResult('path-traversal-result', `Error: ${error.message}`, 'error');
            }
        }

        // Behavioral Detection Tests
        async function testDDoS() {
            showResult('ddos-result', 'üîÑ Testing DDoS detection...', 'warning');

            let blockedCount = 0;
            const promises = [];

            for (let i = 0; i < 20; i++) {
                promises.push(fetch('/test/ddos').then(response => {
                    if (response.status === 429 || response.status === 403) {
                        blockedCount++;
                    }
                    return response.status;
                })
                    .catch(() => 500)
                );
            }

            await Promise.all(promises);

            const message = blockedCount > 0
                ? `‚úÖ DDoS protection active! ${blockedCount} requests blocked`
                : '‚ö†Ô∏è DDoS protection may need tuning';
            const type = blockedCount > 0 ? 'success' : 'warning';

            showResult('ddos-result', message, type);
        }

        async function testAPIAbuse() {
            showResult('api-abuse-result', 'üîÑ Testing API abuse detection...', 'warning');

            let flaggedCount = 0;
            for (let i = 0; i < 10; i++) {
                try {
                    const response = await fetch('/api/users'); if (response.status === 429 ||
                        response.status === 403) { flaggedCount++; } await new Promise(resolve => setTimeout(resolve, 50));
                } catch (error) {
                    console.error('API abuse test error:', error);
                }
            }

            const message = flaggedCount > 0
                ? `‚úÖ API abuse detection active! ${flaggedCount} requests flagged`
                : '‚ö†Ô∏è API abuse detection may need tuning';
            const type = flaggedCount > 0 ? 'success' : 'warning';

            showResult('api-abuse-result', message, type);
        }

        async function testDataExfiltration() {
            try {
                const response = await fetch('/export/users?count=50000');

                const type = response.status === 400 || response.status === 403 ? 'success' : 'warning';
                const message = response.status === 400 || response.status === 403
                    ? '‚úÖ Data exfiltration attempt detected!'
                    : `‚ö†Ô∏è Data exfiltration not detected (Status: ${response.status})`;

                showResult('data-exfiltration-result', message, type);
            } catch (error) {
                showResult('data-exfiltration-result', `Error: ${error.message}`, 'error');
            }
        }

        async function testPrivilegeEscalation() {
            try {
                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'testuser',
                        role: 'admin',
                        permission: 'superuser'
                    })
                });

                const type = response.status === 403 ? 'success' : 'warning';
                const message = response.status === 403
                    ? '‚úÖ Privilege escalation detected and blocked!'
                    : `‚ö†Ô∏è Privilege escalation not detected (Status: ${response.status})`;

                showResult('privilege-escalation-result', message, type);
            } catch (error) {
                showResult('privilege-escalation-result', `Error: ${error.message}`, 'error');
            }
        }

        async function testReconnaissance() {
            try {
                const response = await fetch('/robots.txt');

                const type = response.status === 404 ? 'success' : 'warning';
                const message = response.status === 404
                    ? '‚úÖ Reconnaissance attempt logged (robots.txt not found)'
                    : `‚ö†Ô∏è Reconnaissance detection may need tuning (Status: ${response.status})`;

                showResult('reconnaissance-result', message, type);
            } catch (error) {
                showResult('reconnaissance-result', `Error: ${error.message}`, 'error');
            }
        }

        async function testSessionHijacking() {
            try {
                const response = await fetch('/auth/profile', {
                    headers: {
                        'User-Agent': 'curl/7.68.0',
                        'X-Forwarded-For': '192.168.1.100'
                    }
                });

                const type = response.status === 403 || response.status === 401 ? 'success' : 'warning';
                const message = response.status === 403 || response.status === 401
                    ? '‚úÖ Potential session hijacking detected!'
                    : `‚ö†Ô∏è Session hijacking not detected (Status: ${response.status})`;

                showResult('session-hijacking-result', message, type);
            } catch (error) {
                showResult('session-hijacking-result', `Error: ${error.message}`, 'error');
            }
        }

        // Business Hours and Geolocation Tests
        async function testBusinessHours() {
            try {
                const response = await fetch('/admin/dashboard');

                const type = response.status === 200 ? 'warning' : 'success';
                const message = response.status === 200
                    ? '‚ö†Ô∏è Admin access allowed (may trigger business hours warning)'
                    : `‚úÖ Business hours restriction active (Status: ${response.status})`;

                showResult('business-hours-result', message, type);
            } catch (error) {
                showResult('business-hours-result', `Error: ${error.message}`, 'error');
            }
        }

        async function testGeolocation() {
            try {
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Country': 'CN'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'password123'
                    })
                });

                const type = response.status === 403 ? 'success' : 'warning';
                const message = response.status === 403
                    ? '‚úÖ Geolocation anomaly detected!'
                    : `‚ö†Ô∏è Geolocation check may need configuration (Status: ${response.status})`;

                showResult('geolocation-result', message, type);
            } catch (error) {
                showResult('geolocation-result', `Error: ${error.message}`, 'error');
            }
        }

        // Metrics and Utility Functions
        async function refreshMetrics() {
            try {
                const response = await fetch('/metrics');
                const metrics = await response.json();

                let metricsHTML = '<h3>üõ°Ô∏è Security Metrics</h3>';

                if (metrics.plugins && metrics.plugins.generic_detector) {
                    const detectorMetrics = metrics.plugins.generic_detector;
                    metricsHTML += `
            <div class="metric-item">
                <span>Total Security Checks:</span>
                <span>${detectorMetrics.total_checks || 0}</span>
            </div>
            <div class="metric-item">
                <span>Threats Detected:</span>
                <span>${detectorMetrics.threats_found || 0}</span>
            </div>
            <div class="metric-item">
                <span>Detection Rate:</span>
                <span>${((detectorMetrics.detection_rate || 0) * 100).toFixed(2)}%</span>
            </div>
            <div class="metric-item">
                <span>Active Rules:</span>
                <span>${detectorMetrics.rules_count || 0}</span>
            </div>
            `;
                }

                if (metrics.rule_engine) {
                    metricsHTML += `
            <h3 style="margin-top: 20px;">‚öôÔ∏è Rule Engine</h3>
            <div class="metric-item">
                <span>Requests Processed:</span>
                <span>${metrics.rule_engine.requests_processed || 0}</span>
            </div>
            <div class="metric-item">
                <span>Requests Blocked:</span>
                <span>${metrics.rule_engine.requests_blocked || 0}</span>
            </div>
            `;
                }

                document.getElementById('security-metrics').innerHTML = metricsHTML;
            } catch (error) {
                document.getElementById('security-metrics').innerHTML =
                    `<h3>‚ùå Error loading metrics</h3>
            <p>${error.message}</p>`;
            }
        }

        async function runAllTests() {
            const tests = [
                testBotLogin,
                testLoginRateLimit,
                testMultipleLogins,
                testCredentialStuffing,
                testSQLInjection,
                testXSS,
                testCommandInjection,
                testPathTraversal,
                testDDoS,
                testDataExfiltration,
                testPrivilegeEscalation,
                testReconnaissance,
                testSessionHijacking,
                testBusinessHours,
                testGeolocation
            ];

            showResult('security-metrics', 'üîÑ Running comprehensive security tests...', 'warning');

            for (let i = 0; i < tests.length; i++) {
                try {
                    await tests[i](); await new Promise(resolve =>
                        setTimeout(resolve, 500));
                } catch (error) {
                    console.error(`Test ${i + 1} failed:`, error);
                }
            }

            setTimeout(refreshMetrics, 2000);
        }

        // Initialize metrics on page load
        document.addEventListener('DOMContentLoaded', function () {
            refreshMetrics();

            // Auto-refresh metrics every 30 seconds
            setInterval(refreshMetrics, 30000);
        });
    </script>
</body>

</html>
